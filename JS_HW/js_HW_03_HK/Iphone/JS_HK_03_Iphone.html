<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <title>Apple</title>

    <style>
        #choose_type,
        #choose_color,
        #choose_storage,
        #choose_network,
        #_price {
            margin: 50px 0 12px;
            font-size: 18px;
            font-weight: bolder;
        }

        .btn {
            border: 2px solid #eee;
            padding: 30px;
            border-radius: 20px;
        }

        .button_inner_row .col-6:nth-of-type(1) {
            text-align: left;
        }

        #infoSmall {
            font-size: 12px;
        }

        .nav_container {
            background-color: #000;
            opacity: .8;
        }

        .totalct {
            background-color: rgba(188, 188, 188, .2)
        }

        .totalct>p {
            padding: 20px;
            font-size: 20px;
            line-height: 20px;
        }

        /* DOM CSS */
        .sizeBtn {
            display: flex;
            justify-content: space-between;
            margin: 1% .5%;
            width: 99%;
        }

        .sizeBtn p,
        .sizeBtn b {
            font-size: 20px;
            line-height: 20px;
        }


        .colorBtn,
        .storageBtn,
        .networkBtn {
            margin: 1%;
            width: 48%;
            font-size: 20px;
        }
    </style>
</head>

<body>

    <div class="container nav_container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navbar-expand-lg navbar-light ">
                    <div class="container-fluid">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon bg-white"></span>
                        </button>
                        <!-- <a class="navbar-brand text-white" href="#">Apple</a> -->
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                                <li class="nav-item p-2 fs-5">
                                    <a id="iPad" class="nav-link text-light active" aria-current="page" href="#">
                                        iPad Pro</a>
                                </li>
                                <li class="nav-item p-2 fs-5">
                                    <a id="iPhone12Pro" class="nav-link text-light" href="#">iPhone12 Pro</a>
                                </li>
                                <li class="nav-item p-2 fs-5">
                                    <a id="iMac" class="nav-link text-light" href="#">iMac</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <div class="container text-end totalct">
        <p class="total">NT$</p>
    </div>

    <div class="container" id="productContainer">
        <div class="row">
            <div class="col-12 col-md-6" style="visibility:hidden">
                <div class="row m-5">
                    <img src="" alt="" class="mx-auto w-100" id='img'>
                </div>
                <div class="row m-5 d-flex justify-content-between text-center">
                    <div class="col">
                        <img src="./pic/nopaybuy.svg" alt="">
                        <p id="infoSmall">免額外付費的運送服務 </p>
                    </div>
                    <div class="col">
                        <img src="./pic/smile.svg" alt="">
                        <p id="infoSmall">免額外付費的個人化鐫刻服務 </p>
                    </div>
                    <div class="col">
                        <img src="./pic/nopayreturn.svg" alt="">
                        <p id="infoSmall">免額外付費輕鬆退貨 </p>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6" style="visibility:hidden">
                <div class="row" id="information_row">
                    <span class="text-danger mt-5 mb-2">全新</span>
                    <h2 class="fw-bolder fs-1" id="buy">購買iPad Pro</h2>
                    <span>購買 iPad 可享免額外付費運送服務。 </span>
                    <span>每位顧客限購 2 部 11 吋 iPad Pro 和 2 部 12.9 吋 iPad Pro。 </span>
                </div>
                <div class="row">
                    <h2 id="choose_type">機型</h2>
                    <div id="type_row"></div>
                </div>
                <div class="row">
                    <h2 id="choose_color">外觀</h2>
                    <div id="color_row"></div>
                </div>
                <div class="row">
                    <h2 id="choose_storage">儲存裝置</h2>
                    <div id="storage_row"></div>

                </div>
                <div class="row">
                    <h2 id="choose_network">連線能力</h2>
                    <div id="network_row"></div>
                </div>
                <div class="row">
                    <h2 id="_price">價格</h2>
                    <div id="total_row"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // xhr
        const url =
            "https://raw.githubusercontent.com/Girro39/Girro39.github.io/main/JS_HW/js_HW_03_HK/Iphone/products.json";
        let AppleProducts = [];
        let xhr = new XMLHttpRequest();
        xhr.onload = function () {
            AppleProducts = JSON.parse(this.responseText);
            iPad.addEventListener('click', createiPadPro);
            iPhone12Pro.addEventListener('click', createiPhone12Pro);
            iMac.addEventListener('click', createiMac);
        }
        xhr.open('GET', url);
        xhr.send();

        //#region 宣告
        // nav 上的 ipad ip12 imac
        let iPad = idget('iPad');
        let iPhone12Pro = idget('iPhone12Pro');
        let iMac = idget('iMac');
        let img = idget('img');
        let buy = idget('buy');
        // 機型 外觀 儲存裝置 連線能力 價格
        let choose_type = idget('choose_type');
        let choose_color = idget('choose_color');
        let choose_storage = idget('choose_storage');
        let choose_network = idget('choose_network');
        let _price = idget('_price');
        //機型 外觀 儲存裝置 連線能力 價格 個別下方row
        let type_row = idget('type_row');
        let color_row = idget('color_row');
        let storage_row = idget('storage_row');
        let network_row = idget('network_row');
        let total_row = idget('total_row');
        //#endregion

        //document getelementbyid
        function idget(id) {
            return document.getElementById(id);
        }

        //document createelement
        function crel(element, clname) {
            let ele = document.createElement(element);
            ele.setAttribute('class', clname);
            return ele
        }

        function visible() {
            let productContainer = document.querySelectorAll('#productContainer .col-12');
            productContainer.forEach((item) => {
                item.setAttribute('style', 'visibility: visible')
            });
        }

        function createiPadPro() {
            visible();
            buy.innerHTML = '';
            buy.innerHTML = '購買iPad Pro'
            img.src =
                'https://store.storeimages.cdn-apple.com/8756/as-images.apple.com/is/ipad-pro-12-11-select-202104_GEO_TW?wid=545&hei=550&fmt=jpeg&qlt=95&.v=1617864731000'
            createiPadProSize();
            createiPadProColor();
            createiPadProStorage();
            createiPadProNetwork();
        }

        function createiPadProSize() {
            type_row.innerHTML = '';
            Object.keys(AppleProducts[0]).forEach((item) => {
                let sizeBtn = crel('button', 'btn sizeBtn');
                sizeBtn.innerHTML =
                    `<p>
                        ${item}
                    </p>
                    <b>NT$${ Object.values(AppleProducts[0])
                                        .filter(x => x.model == item)[0]
                                        .products.太空灰色[0]
                                        .price}起
                    </b>`;
                type_row.appendChild(sizeBtn);
            })
        }

        function concatColorsArray(colors) {
            let gray_11 =
                Object.values(Object.values(AppleProducts[0])[0].products)[0].map(x => {
                    return {
                        size: x.size,
                        color: x.color,
                        colordot: x.colordot,
                        img: x.img
                    }
                })[0];
            let silver_11 =
                Object.values(Object.values(AppleProducts[0])[0].products)[1].map(x => {
                    return {
                        size: x.size,
                        color: x.color,
                        colordot: x.colordot,
                        img: x.img
                    }
                })[0];
            colors.push(gray_11);
            colors.push(silver_11);
        }

        function createiPadProColor() {
            color_row.innerHTML = '';
            let colors = [];
            concatColorsArray(colors);

            colors.forEach((item) => {
                let colorBtn = crel('button', 'btn colorBtn');
                colorBtn.innerHTML = `
                    <img src="${item.colordot}">
                    <p>${item.color}</p>
                `
                color_row.appendChild(colorBtn);
            });
        }

        function createiPadProStorage() {
            storage_row.innerHTML = '';
            let storages =
                Object.values(Object.values(AppleProducts[0])[0].products)[0].filter(x => x.network == 'WiFi').map(
                    x => {
                        return {
                            storage: x.storage,
                            price: x.price
                        }
                    });
            storages.forEach((item) => {
                let storageBtn = crel('button', 'btn storageBtn');
                storageBtn.innerHTML = `
                    <b>${item.storage}</b>
                `
                storage_row.appendChild(storageBtn);
            })
        }

        function createiPadProNetwork() {
            let networks =
                Object.values(Object.values(AppleProducts[0])[0].products)[0].filter(x => x.storage == '128GB').map(
                    x => {
                        return {
                            network: x.network
                        }
                    });
            networks.forEach((item) => {
                let networkBtn = crel('button', 'btn networkBtn');
                networkBtn.innerHTML = `
                    <b>${item.network}</b>
                `
                network_row.appendChild(networkBtn);
            })
            console.log(networks);
        }

        function createiPhone12Pro() {
            displayblock();
            buy.innerHTML = '';
            buy.innerHTML = '購買iPhone 12 Pro';
            img.src =
                'https://store.storeimages.cdn-apple.com/8756/as-images.apple.com/is/iphone-12-pro-family-hero?wid=470&hei=556&fmt=jpeg&qlt=95&.v=1604021663000';
        }

        function createiMac() {
            displayblock();
            buy.innerHTML = '';
            buy.innerHTML = '購買iMac'
            img.src =
                'https://store.storeimages.cdn-apple.com/8756/as-images.apple.com/is/imac-24-blue-selection-hero-202104?wid=452&hei=420&fmt=jpeg&qlt=95&.v=1617492405000'
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>

</body>

</html>